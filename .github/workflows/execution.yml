name: Execution
on:
  schedule:
    # It should run at 7 am German time
    # Summer time: Germany UTC+2 -> '0 5 * * *'
    # Winter time: Germany UTC+1 -> '0 6 * * *'
    - cron:  '0 5 * * *'
jobs:
  Execution:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v2
      - name: Set up JDK 16
        uses: actions/setup-java@v1
        with:
          java-version: 16
      - name: Cache Maven packages
        uses: actions/cache@v2
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: ${{ runner.os }}-m2
      - name: Build with Maven
        run: mvn clean compile assembly:single
      - name: Execution of the file
        env: # Environment variable
          DSB_USERNAME: ${{ secrets.DSB_USERNAME }}
          DSB_PASSWORD: ${{ secrets.DSB_PASSWORD }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: java -jar target/StatusInformation-1.0.0-jar-with-dependencies.jar $DSB_USERNAME $DSB_PASSWORD $TELEGRAM_CHANNEL_ID $TELEGRAM_BOT_TOKEN
